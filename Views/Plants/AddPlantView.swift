////  AddPlantView.swift//  Vrtko////  Created by Mihael Lendvaj on 31.05.2025..//import SwiftUIstruct AddPlantView: View {    let gardenId: String    @Environment(\.dismiss) var dismiss    @ObservedObject var plantRepo: PlantRepository    @State private var selectedPlantTypeId: String = ""    @State private var variety: String = ""    @State private var datePlanted: Date = Date()    @State private var notes: String = ""    @State private var errorMessage: String = ""    // Dohvat odabranog PlantType objekta prema ID-u    var selectedPlantType: PlantType? {        PlantCatalog.all.first(where: { $0.uniqueId == selectedPlantTypeId })    }    var body: some View {        NavigationView {            Form {                Section(header: Text("Vrsta biljke")) {                    Picker("Vrsta", selection: $selectedPlantTypeId) {                        ForEach(PlantCatalog.all, id: \.uniqueId) { type in                            HStack {                                Text(type.icon)                                Text(type.name)                            }.tag(type.uniqueId)                        }                    }                }                Section(header: Text("Detalji")) {                    TextField("Sorta (opcionalno)", text: $variety)                    DatePicker("Datum sadnje", selection: $datePlanted, displayedComponents: .date)                    TextField("Napomena", text: $notes)                }                if !errorMessage.isEmpty {                    Text(errorMessage).foregroundColor(.red)                }            }            .navigationTitle("Dodaj biljku")            .toolbar {                ToolbarItem(placement: .confirmationAction) {                    Button("Spremi") {                        Task { await savePlant() }                    }                }                ToolbarItem(placement: .cancellationAction) {                    Button("Odustani") { dismiss() }                }            }            .onAppear {                if selectedPlantTypeId.isEmpty, let first = PlantCatalog.all.first {                    selectedPlantTypeId = first.uniqueId                }            }        }    }    private func savePlant() async {        guard let selectedPlantType = selectedPlantType else {            errorMessage = "Odaberi biljku."            return        }        let newPlant = GardenPlant(            id: nil,            gardenId: gardenId,            plantType: selectedPlantType,            variety: variety,            status: .planted,            plantedDate: datePlanted,            expectedHarvestDate: nil,            actualHarvestDate: nil,            notes: notes,            photos: [],            location: nil        )        do {            try await plantRepo.addPlant(newPlant)            dismiss()        } catch {            errorMessage = "Gre≈°ka pri spremanju: \(error.localizedDescription)"        }    }}// Helper za uniqueId PlantType-a (dodaj u PlantType ili kao extension)extension PlantType {    var uniqueId: String {        (name + "_" + category.rawValue).lowercased()    }}
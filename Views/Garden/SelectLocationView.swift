////  SelectLocationView.swift//  Vrtko////  Created by Mihael Lendvaj on 01.06.2025..//import SwiftUIimport MapKitstruct SelectLocationView: View {    @Environment(\.dismiss) var dismiss    @Binding var selectedCoordinate: CLLocationCoordinate2D?    @State private var region: MKCoordinateRegion    init(selectedCoordinate: Binding<CLLocationCoordinate2D?>) {        _selectedCoordinate = selectedCoordinate        let defaultCoordinate = CLLocationCoordinate2D(latitude: 45.815, longitude: 15.9819)        _region = State(initialValue: MKCoordinateRegion(            center: selectedCoordinate.wrappedValue ?? defaultCoordinate,            span: MKCoordinateSpan(latitudeDelta: 0.02, longitudeDelta: 0.02)        ))    }    var body: some View {        VStack {            Map(coordinateRegion: $region, annotationItems: annotationItems) { item in                MapMarker(coordinate: item.coordinate, tint: .primaryGreen)            }            .gesture(                DragGesture(minimumDistance: 0)                    .onEnded { value in                        let mapPoint = value.location                        let coordinate = coordinateFrom(point: mapPoint, in: region)                        selectedCoordinate = coordinate                    }            )            .edgesIgnoringSafeArea(.all)            .overlay(alignment: .top) {                Text("Dodirni kartu za odabir lokacije")                    .padding(8)                    .background(Color.white.opacity(0.8))                    .cornerRadius(8)                    .padding()            }            Button("Spremi lokaciju") {                dismiss()            }            .font(.headline)            .foregroundColor(.white)            .padding()            .frame(maxWidth: .infinity)            .background(Color.primaryGreen)            .cornerRadius(12)            .padding()        }    }    private var annotationItems: [MapAnnotationItem] {        if let coord = selectedCoordinate {            return [MapAnnotationItem(coordinate: coord)]        }        return []    }}// Helper funkcija za konverziju toÄke na ekranu u koordinate (pojednostavljeno)func coordinateFrom(point: CGPoint, in region: MKCoordinateRegion) -> CLLocationCoordinate2D {    let span = region.span    let center = region.center    let mapWidth: CGFloat = UIScreen.main.bounds.width    let mapHeight: CGFloat = UIScreen.main.bounds.height    let xPercent = point.x / mapWidth    let yPercent = point.y / mapHeight    let latitude = center.latitude + (Double(yPercent - 0.5) * -span.latitudeDelta)    let longitude = center.longitude + (Double(xPercent - 0.5) * span.longitudeDelta)    return CLLocationCoordinate2D(latitude: latitude, longitude: longitude)}